<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Demande de devis - Couverture</title>
<style>
  :root {
    --bg:#f0f4f8;
    --card:#fff;
    --primary:#0d6efd;
    --primary-dark:#0b5ed7;
    --muted:#6c757d;
    --radius:12px;
    --shadow:0 10px 25px rgba(0,0,0,0.08);
    font-family:Arial,sans-serif;
    font-size:16px;
  }
  body {margin:0; background:var(--bg); display:flex; justify-content:center; align-items:center; min-height:100vh; padding:20px;}
  .container {background:var(--card); padding:30px; border-radius:var(--radius); width:100%; max-width:720px; box-shadow:var(--shadow);}
  h1 {text-align:center; margin-bottom:20px; color:var(--primary);}
  form {display:grid; gap:16px;}
  .row {display:grid; gap:16px;}
  .row.two {grid-template-columns:1fr 1fr;}
  label {font-weight:600; color:var(--muted);}
  input, select, textarea {width:100%; padding:12px; border-radius:8px; border:1px solid #ced4da; font-size:1rem; box-sizing:border-box;}
  textarea {min-height:100px; resize:vertical;}
  .actions {display:flex; gap:12px; margin-top:10px;}
  button {padding:12px 16px; border:none; border-radius:8px; font-weight:600; cursor:pointer;}
  button[type="submit"] {background:var(--primary); color:#fff; flex:1;}
  button[type="submit"]:hover {background:var(--primary-dark);}
  button.secondary {background:#e9ecef; color:#111;}
  .tarif {display:none; background:#e7f1ff; border-left:4px solid var(--primary); padding:16px; border-radius:8px; margin-top:15px;}
  .error {color:#d63384; font-size:0.9rem;}
  .hint {font-size:0.9rem; color:var(--muted);}
  @media (max-width:640px){.row.two{grid-template-columns:1fr}}
</style>
</head>
<body>
<main class="container">
<h1>Demande de devis — Couverture</h1>

<form id="devisForm" novalidate>
  <div class="row">
    <div>
      <label for="localisation">Localisation</label>
      <input id="localisation" name="localisation" type="text" placeholder="Ville / Adresse" required>
      <div class="error" id="localisationError"></div>
    </div>
  </div>

  <div class="row two">
    <div>
      <label for="typeTravaux">Type de travaux</label>
      <select id="typeTravaux" name="typeTravaux" required>
        <option value="">— Choisir —</option>
        <option value="neuf">Toiture neuve</option>
        <option value="reparation">Réparation</option>
      </select>
      <div class="error" id="typeTravauxError"></div>
    </div>
    <div>
      <label for="materiau">Matériau</label>
      <select id="materiau" name="materiau" required>
        <option value="">— Choisir —</option>
        <option value="tuile">Tuile</option>
        <option value="ardoise">Ardoise</option>
        <option value="zinc">Zinc</option>
      </select>
      <div class="error" id="materiauError"></div>
    </div>
  </div>

  <div class="row two">
    <div>
      <label for="surface">Surface estimée (m²)</label>
      <input id="surface" name="surface" type="number" min="1" step="0.1" placeholder="Ex. 85.5" required>
      <div class="error" id="surfaceError"></div>
    </div>
    <div>
      <label for="hauteur">Hauteur / Complexité (optionnel)</label>
      <select id="hauteur" name="hauteur">
        <option value="standard">Standard</option>
        <option value="elevee">Élevée (accès difficile)</option>
        <option value="tres-elevee">Très élevée (manœuvres spéciales)</option>
      </select>
      <div class="hint">La complexité peut modifier le prix final.</div>
    </div>
  </div>

  <div>
    <label for="description">Description</label>
    <textarea id="description" name="description" placeholder="Détaillez votre demande"></textarea>
  </div>

  <div class="actions">
    <button type="submit">Obtenir un tarif estimé</button>
    <button type="button" class="secondary" id="resetBtn">Réinitialiser</button>
  </div>

  <div id="tarif" class="tarif"></div>
</form>
</main>

<script>
(function(){
  const PRICES={neuf:{tuile:120,ardoise:150,zinc:180}, reparation:{tuile:60,ardoise:80,zinc:100}};
  const COMPLEXITY={standard:1, elevee:1.12, 'tres-elevee':1.25};
  const form=document.getElementById('devisForm');
  const tarifBox=document.getElementById('tarif');
  const resetBtn=document.getElementById('resetBtn');

  function formatCurrency(value){
    return new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR',maximumFractionDigits:0}).format(value);
  }

  function clearErrors(){
    ['localisationError','typeTravauxError','materiauError','surfaceError'].forEach(id=>document.getElementById(id).textContent='');
  }

  function validate(values){
    const errors={};
    if(!values.localisation.trim()) errors.localisation='Veuillez indiquer une localisation.';
    if(!values.typeTravaux) errors.typeTravaux='Choisissez le type de travaux.';
    if(!values.materiau) errors.materiau='Choisissez un matériau.';
    const s=Number(values.surface);
    if(!values.surface || isNaN(s) || s<=0) errors.surface='Entrez une surface valide (> 0).';
    return errors;
  }

  function showErrors(errors){
    clearErrors();
    for(const key in errors) document.getElementById(key+'Error').textContent=errors[key];
  }

  function computeCost(values){
    const basePrice=PRICES[values.typeTravaux][values.materiau];
    const multiplier=COMPLEXITY[values.hauteur]||1;
    const surface=Number(values.surface);
    const subtotal=basePrice*surface;
    return { basePrice, surface, subtotal, multiplier, adjusted:subtotal*multiplier };
  }

  function showResult(res){
    tarifBox.style.display='block';
    tarifBox.innerHTML=`
      <div><strong>Tarif moyen estimé :</strong> ${formatCurrency(res.adjusted)}</div>
      <div>Détail : ${formatCurrency(res.basePrice)} €/m² × ${res.surface} m² = ${formatCurrency(res.subtotal)}</div>
      <div>Complexité (multiplicateur) : ${res.multiplier}</div>
      <div class="hint">Ceci est une estimation. Pour un devis précis, un diagnostic sur site est requis.</div>
    `;
  }

  form.addEventListener('submit', e=>{
    e.preventDefault();
    const data={
      localisation:form.localisation.value,
      typeTravaux:form.typeTravaux.value,
      materiau:form.materiau.value,
      surface:form.surface.value,
      hauteur:form.hauteur.value||'standard',
      description:form.description.value
    };
    const errors=validate(data);
    if(Object.keys(errors).length){showErrors(errors); tarifBox.style.display='none'; return;}
    const result=computeCost(data);
    showResult(result);
  });

  resetBtn.addEventListener('click', ()=>{
    form.reset();
    tarifBox.style.display='none';
    clearErrors();
  });
})();
</script>
</body>
</html>
